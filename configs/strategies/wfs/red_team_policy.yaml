# Red-Team Hardened WFS Governance Policy
# YAML-structure based policy for enforcing research integrity

version: "1.0"
description: "Red-Team Hardened WFS Policy with Scoring Guards and Mode B"

# Scoring Guard Configuration
scoring_guards:
  enabled: true
  config:
    t_max: 100
    alpha: 0.25
    min_avg_profit: 5.0
    cliff_threshold: 0.3
    oat_neighborhood_size: 5
    bimodality_threshold: 0.15

# Mode B Configuration
mode_b:
  enabled: false  # Set to true to enable Mode B pipeline
  config:
    entry_param_names: ["entry_window", "entry_threshold"]
    exit_param_names: ["exit_window", "exit_threshold", "trail_atr_mult"]
    target_signal_rate: 0.05
    calibration_method: "logarithmic"
    num_anchors: 10
    enforce_structure_test: true

# Governance Triggers
governance_triggers:
  - name: "scoring_guard_compliance"
    description: "Ensure scoring guards are applied and passed"
    severity: "high"
    condition: "scoring_guards.enabled == true"
    action: "require_edge_gate_passed"
    
  - name: "mode_b_structure_test"
    description: "Mode B structure test for parameter coupling"
    severity: "medium"
    condition: "mode_b.enabled == true"
    action: "enforce_structure_test"
    
  - name: "bimodality_defense"
    description: "Cluster test hardening against bimodal distributions"
    severity: "medium"
    condition: "scoring_guards.enabled == true"
    action: "detect_bimodality"
    
  - name: "minimum_edge_gate"
    description: "Minimum average profit per trade"
    severity: "high"
    condition: "scoring_guards.enabled == true"
    action: "enforce_min_avg_profit"
    params:
      min_avg_profit: 5.0

# Artifact Requirements
artifact_requirements:
  - name: "scoring_guard_report"
    required: true
    description: "Scoring guard application results"
    
  - name: "governance_compliance_report"
    required: true
    description: "Governance trigger compliance status"
    
  - name: "delta_report"
    required: false
    description: "Delta report comparing with baseline (if available)"
    
  - name: "integrity_hash"
    required: true
    description: "SHA256 hash of artifact bundle for integrity verification"

# Validation Rules
validation_rules:
  - field: "final_score_guarded"
    type: "float"
    min: 0.0
    max: 1000.0
    required: true
    
  - field: "edge_gate_passed"
    type: "boolean"
    required: true
    
  - field: "cliff_gate_passed"
    type: "boolean"
    required: true
    
  - field: "bimodality_detected"
    type: "boolean"
    required: true

# Compliance Thresholds
compliance_thresholds:
  scoring_guard_compliance: 1.0  # Must be 100% compliant
  mode_b_compliance: 0.8  # 80% compliance required if mode_b enabled
  overall_compliance: 0.9  # 90% overall compliance required

# Metadata
metadata:
  created_at: "2026-01-15T00:00:00Z"
  created_by: "Red-Team WFS System"
  last_updated: "2026-01-15T00:00:00Z"
  applies_to: ["S1", "S2", "S3", "breakout_channel_v1", "mean_revert_zscore_v1"]