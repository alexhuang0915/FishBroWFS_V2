# Phase 8 — Desktop UX Contract Discovery

## Environment
- Python version: `3.12` (see python_version.txt)
- Workspace: `/home/fishbro/FishBroWFS_V2`
- Desktop UI entrypoint: `src/gui/desktop/control_station.py` (ControlStation QMainWindow)

## Desktop UI Structure

### Main Window
- **ControlStation** (`src/gui/desktop/control_station.py`): Main window with 6 tabs:
  1. **Operation** (`OpTab`) – Launch pad + job tracker
  2. **Report** (`ReportTab`) – Run diagnostics and artifact checklist
  3. **Strategy Library** (`RegistryTab`) – Strategy registry browser
  4. **Allocation** (`AllocationTab`) – Portfolio allocation builder
  5. **Audit** (`AuditTab`) – Job/portfolio audit trail
  6. **Portfolio Admission** (`PortfolioAdmissionTab`) – Admission sandbox

### Job Lifecycle Visualization (Current State)
- **Job Tracker** is implemented in `OpTab` (`src/gui/desktop/tabs/op_tab.py`):
  - Uses `JobsTableModel` to fetch jobs via `get_jobs()` API.
  - Columns: Job ID, Strategy, Instrument, Timeframe, Run Mode, Season, Status, Duration, Score, Created, Finished, Actions.
  - Status values: `PENDING`, `RUNNING`, `SUCCEEDED`, `FAILED`, `REJECTED`, `STARTED`, `CREATED`.
  - Color coding: green for SUCCEEDED, red for FAILED/REJECTED, amber for RUNNING, grey for PENDING.
  - Auto‑refresh: 1s when jobs are running, 5s otherwise.
  - Filtering by status, strategy, instrument, season.
  - Actions column: "View Logs", "Open Evidence", "Open Report", "Explain Failure".

### Supervisor API Endpoints Used
- `GET /api/v1/jobs` – list jobs (limit=50)
- `GET /api/v1/jobs/{job_id}` – job details
- `GET /api/v1/jobs/{job_id}/artifacts` – artifact index
- `GET /api/v1/jobs/{job_id}/logs/stdout_tail` – log tail
- `GET /api/v1/jobs/{job_id}/reveal_evidence_path` – evidence path
- `GET /api/v1/reports/strategy/{job_id}` – strategy report
- `GET /api/v1/readiness/{season}/{dataset_id}/{timeframe}` – readiness check

### Job Data Model (from API)
From `get_jobs()` response (list of dicts), each job includes:
- `job_id` (string)
- `status` (string)
- `strategy_name` (string)
- `instrument` (string)
- `timeframe` (int)
- `season` (string)
- `run_mode` (string)
- `created_at` (ISO timestamp)
- `finished_at` (ISO timestamp or null)
- `duration_seconds` (float)
- `score` (float or null)
- `error_message` (optional, string)
- `rejection_reason` (optional, string)

### Evidence Artifacts Location
- Canonical outputs tree: `outputs/seasons/{season}/runs/{job_id}/`
- Typical artifacts:
  - `manifest.json` – run metadata
  - `metrics.json` – performance metrics
  - `admission_report.json` – admission results (if applicable)
  - `strategy_report.json` – strategy report (generated by supervisor)
  - `logs.txt` – stdout/stderr logs
- Evidence path is resolved via `get_reveal_evidence_path(job_id)` which returns a dict with `path` key.

### Readiness Dependency Chain
- **ReadinessState** (`src/gui/desktop/state/readiness_state.py`) – SSOT for UI readiness.
- Checks bars and features readiness via supervisor API.
- Used in `OpTab` to disable actions and show tooltips.
- Missing: explicit panel showing satisfied/missing prerequisites.

### Failure Reason Extraction
- Currently, `explain_failure` in `OpTab` reads `manifest.json` and `admission_report.json` to extract failure reasons.
- Shows raw JSON snippets; not human‑readable with next‑action recommendations.

### Evidence Navigation
- **Open Evidence** button uses `get_reveal_evidence_path` and opens folder via `QDesktopServices`.
- **Open Report** button fetches `get_strategy_report_v1` and switches to Audit tab.
- **View Logs** opens `LogViewerDialog` with stdout tail.
- Missing: unified evidence browser listing all artifacts with presence indicators.

## Gaps Identified (Phase 8 Targets)

1. **Job Lifecycle Visualization** – Already present but could be enhanced with:
   - Age/relative time (e.g., "2 hours ago")
   - Stage hint (preflight/run/postflight) not available in job data.
   - Compact visual badges with icons.

2. **Human‑Readable Reasons** – Need a service to normalize error messages and suggest next actions.

3. **Evidence‑First Navigation** – Need a dedicated evidence locator service and UI panel.

4. **Explicit Readiness Panel** – Need a widget that shows satisfied/missing prerequisites beyond tooltips.

## Next Steps
Proceed with Phase 8.1–8.4 implementations as outlined in the specification.